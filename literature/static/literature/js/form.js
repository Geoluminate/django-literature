
CSL_TYPES = {
  "article": [
      "title",
      "abstract",
      "genre",
      "repository",
      "archiveID",
      "publisher-place",
      "issued",
      "collection-title",
      "collection-number",
      "DOI",
      "citationKey",
      "URL",
      "accessed",
      "archive",
      "archive_location",
      "title-short",
      "language",
      "source",
      "call-number",
      "license",
      "note",
      "creator",
  ],
  "article-journal": [
      "title",
      "abstract",
      "container-title",
      "volume",
      "issue",
      "page",
      "issued",
      "collection-title",
      "seriesText",
      "journalAbbreviation",
      "language",
      "DOI",
      "ISSN",
      "title-short",
      "URL",
      "accessed",
      "archive",
      "archive_location",
      "source",
      "call-number",
      "license",
      "note",
      "creator",
  ],
  "article-magazine": [
      "title",
      "abstract",
      "container-title",
      "volume",
      "issue",
      "issued",
      "page",
      "language",
      "ISSN",
      "title-short",
      "URL",
      "accessed",
      "archive",
      "archive_location",
      "source",
      "call-number",
      "license",
      "note",
      "creator",
  ],
  "article-newspaper": [
      "title",
      "abstract",
      "container-title",
      "publisher-place",
      "edition",
      "issued",
      "section",
      "page",
      "language",
      "title-short",
      "ISSN",
      "URL",
      "accessed",
      "archive",
      "archive_location",
      "source",
      "call-number",
      "license",
      "note",
      "creator",
  ],
  "bill": [
      "title",
      "abstract",
      "billNumber",
      "container-title",
      "codeVolume",
      "section",
      "codePages",
      "authority",
      "chapter-number",
      "references",
      "issued",
      "language",
      "URL",
      "accessed",
      "title-short",
      "license",
      "note",
      "creator",
  ],
  "book": [
      "title",
      "abstract",
      "collection-title",
      "collection-number",
      "volume",
      "number-of-volumes",
      "edition",
      "publisher-place",
      "publisher",
      "issued",
      "number-of-pages",
      "language",
      "ISBN",
      "title-short",
      "URL",
      "accessed",
      "archive",
      "archive_location",
      "source",
      "call-number",
      "license",
      "note",
      "creator",
  ],
  "broadcast": [
      "title",
      "abstract",
      "programTitle",
      "episodeNumber",
      "videoRecordingFormat",
      "publisher-place",
      "network",
      "issued",
      "dimensions",
      "language",
      "title-short",
      "URL",
      "accessed",
      "archive",
      "archive_location",
      "source",
      "call-number",
      "license",
      "note",
      "creator",
  ],
  "chapter": [
      "title",
      "abstract",
      "bookTitle",
      "collection-title",
      "collection-number",
      "volume",
      "number-of-volumes",
      "edition",
      "publisher-place",
      "publisher",
      "issued",
      "page",
      "language",
      "ISBN",
      "title-short",
      "URL",
      "accessed",
      "archive",
      "archive_location",
      "source",
      "call-number",
      "license",
      "note",
      "creator",
  ],
  "document": [],
  "entry-dictionary": [
      "title",
      "abstract",
      "dictionaryTitle",
      "collection-title",
      "collection-number",
      "volume",
      "number-of-volumes",
      "edition",
      "publisher-place",
      "publisher",
      "issued",
      "page",
      "language",
      "ISBN",
      "title-short",
      "URL",
      "accessed",
      "archive",
      "archive_location",
      "source",
      "call-number",
      "license",
      "note",
      "creator",
  ],
  "entry-encyclopedia": [
      "title",
      "abstract",
      "encyclopediaTitle",
      "collection-title",
      "collection-number",
      "volume",
      "number-of-volumes",
      "edition",
      "publisher-place",
      "publisher",
      "issued",
      "page",
      "ISBN",
      "title-short",
      "URL",
      "accessed",
      "language",
      "archive",
      "archive_location",
      "source",
      "call-number",
      "license",
      "note",
      "creator",
  ],
  "graphic": [
      "title",
      "abstract",
      "artworkMedium",
      "dimensions",
      "issued",
      "language",
      "title-short",
      "archive",
      "archive_location",
      "source",
      "call-number",
      "URL",
      "accessed",
      "license",
      "note",
      "creator",
  ],
  "hearing": [
      "title",
      "abstract",
      "section",
      "publisher-place",
      "publisher",
      "number-of-volumes",
      "documentNumber",
      "page",
      "authority",
      "chapter-number",
      "references",
      "issued",
      "language",
      "title-short",
      "URL",
      "accessed",
      "license",
      "note",
      "creator",
  ],
  "interview": [
      "title",
      "abstract",
      "issued",
      "interviewMedium",
      "language",
      "title-short",
      "URL",
      "accessed",
      "archive",
      "archive_location",
      "source",
      "call-number",
      "license",
      "note",
      "creator",
  ],
  "legal_case": [
      "caseName",
      "abstract",
      "authority",
      "dateDecided",
      "docketNumber",
      "container-title",
      "reporterVolume",
      "firstPage",
      "references",
      "language",
      "title-short",
      "URL",
      "accessed",
      "license",
      "note",
      "creator",
  ],
  "legislation": [
      "nameOfAct",
      "abstract",
      "container-title",
      "volume",
      "publicLawNumber",
      "dateEnacted",
      "page",
      "section",
      "chapter-number",
      "references",
      "language",
      "title-short",
      "URL",
      "accessed",
      "license",
      "note",
      "creator",
  ],
  "manuscript": [
      "title",
      "abstract",
      "manuscriptType",
      "publisher-place",
      "issued",
      "number-of-pages",
      "language",
      "title-short",
      "URL",
      "accessed",
      "archive",
      "archive_location",
      "source",
      "call-number",
      "license",
      "note",
      "creator",
  ],
  "map": [
      "title",
      "abstract",
      "mapType",
      "scale",
      "collection-title",
      "edition",
      "publisher-place",
      "publisher",
      "issued",
      "language",
      "ISBN",
      "title-short",
      "URL",
      "accessed",
      "archive",
      "archive_location",
      "source",
      "call-number",
      "license",
      "note",
      "creator",
  ],
  "motion_picture": [
      "title",
      "abstract",
      "videoRecordingFormat",
      "collection-title",
      "volume",
      "number-of-volumes",
      "publisher-place",
      "studio",
      "issued",
      "dimensions",
      "language",
      "ISBN",
      "title-short",
      "URL",
      "accessed",
      "archive",
      "archive_location",
      "source",
      "call-number",
      "license",
      "note",
      "creator",
  ],
  "paper-conference": [
      "title",
      "abstract",
      "issued",
      "proceedingsTitle",
      "event-title",
      "publisher-place",
      "publisher",
      "volume",
      "page",
      "collection-title",
      "language",
      "DOI",
      "ISBN",
      "title-short",
      "URL",
      "accessed",
      "archive",
      "archive_location",
      "source",
      "call-number",
      "license",
      "note",
      "creator",
  ],
  "patent": [
      "title",
      "abstract",
      "publisher-place",
      "country",
      "assignee",
      "authority",
      "patentNumber",
      "submitted",
      "page",
      "call-number",
      "issue",
      "issueDate",
      "references",
      "status",
      "language",
      "title-short",
      "URL",
      "accessed",
      "license",
      "note",
      "creator",
  ],
  "personal_communication": [
      "title",
      "abstract",
      "letterType",
      "issued",
      "language",
      "title-short",
      "URL",
      "accessed",
      "archive",
      "archive_location",
      "source",
      "call-number",
      "license",
      "note",
      "creator",
  ],
  "post": [
      "title",
      "abstract",
      "forumTitle",
      "postType",
      "issued",
      "language",
      "title-short",
      "URL",
      "accessed",
      "license",
      "note",
      "creator",
  ],
  "post-weblog": [
      "title",
      "abstract",
      "blogTitle",
      "websiteType",
      "issued",
      "URL",
      "accessed",
      "language",
      "title-short",
      "license",
      "note",
      "creator",
  ],
  "report": [
      "title",
      "abstract",
      "reportNumber",
      "reportType",
      "collection-title",
      "publisher-place",
      "institution",
      "issued",
      "page",
      "language",
      "title-short",
      "URL",
      "accessed",
      "archive",
      "archive_location",
      "source",
      "call-number",
      "license",
      "note",
      "creator",
  ],
  "software": [
      "title",
      "abstract",
      "collection-title",
      "version",
      "issued",
      "medium",
      "publisher-place",
      "company",
      "genre",
      "ISBN",
      "title-short",
      "URL",
      "license",
      "archive",
      "archive_location",
      "source",
      "call-number",
      "accessed",
      "note",
      "creator",
  ],
  "song": [
      "title",
      "abstract",
      "audioRecordingFormat",
      "collection-title",
      "volume",
      "number-of-volumes",
      "publisher-place",
      "label",
      "issued",
      "dimensions",
      "language",
      "ISBN",
      "title-short",
      "archive",
      "archive_location",
      "source",
      "call-number",
      "URL",
      "accessed",
      "license",
      "note",
      "creator",
  ],
  "speech": [
      "title",
      "abstract",
      "presentationType",
      "issued",
      "publisher-place",
      "event-title",
      "URL",
      "accessed",
      "language",
      "title-short",
      "license",
      "note",
      "creator",
  ],
  "thesis": [
      "title",
      "abstract",
      "thesisType",
      "university",
      "publisher-place",
      "issued",
      "number-of-pages",
      "language",
      "title-short",
      "URL",
      "accessed",
      "archive",
      "archive_location",
      "source",
      "call-number",
      "license",
      "note",
      "creator",
  ],
  "webpage": [
      "title",
      "abstract",
      "websiteTitle",
      "websiteType",
      "issued",
      "title-short",
      "URL",
      "accessed",
      "language",
      "license",
      "note",
      "creator",
  ],
}


function updateForm(e) {
    var target = e.target;

    // get relevant fields for this "type" value from CSL TYPES
    var relevantFields = CSL_TYPES[target.value];

    // replace hyphens in field names with underscores
    relevantFields = relevantFields.map(function(field) {
        return field.replace(/-/g, "_");
    });


    // loop through form inputs and hide/show based on allowed types without jquery
    var formElements = target.form.elements;
    for (var i = 0; i < formElements.length; i++) {
        var el = formElements[i];

        // get parent selector based on data-CSL-parent
        var targetParent = el.dataset.cslParent;

        // get parent element
        var parent = el.closest(targetParent)

        // if "data-CSL" is set and a parent is found
        if (el.dataset.csl && parent) {

            if (relevantFields.includes(el.name)) {
                // display relevant field elements
                parent.style.display = "block";
            } else {
                // hide non-relevant field elements
                parent.style.display = "none";
            }
        }
    }


    var orderedRelevantNodes = [];

    for (var i=0; i < relevantFields.length; i++) {
        var field = relevantFields[i];
        var el = document.querySelector(`[name="${field}"]`);
        if (!el) {
            console.log(`Could not find element with name "${field}"`);
            continue;
        }
        var parent = el.closest(el.dataset.cslParent);
        orderedRelevantNodes.push(parent);
    }


    target.closest(target.dataset.cslParent).after(...orderedRelevantNodes)
    // loop through relevant fields and append


    // // reinsert fields into the dom based on the order in CSL_TYPES
    // for (var i=0; i < reversedFields.length; i++) {
    //     var el = document.querySelector(`[name="${reversedFields[i]}"]`);
    //     var parent = el.closest(el.dataset.cslParent);

    //     // parent element of the "type" select
    //     var targetParent = target.closest(".form-control");

    //     // move parent to the first position beneath "target"
    //     parent.insertBefore(parent, targetParent.nextSibling);


    //     // parent.parentNode.appendChild(parent);
    // }



    // var fieldset = target.closest("fieldset");
    // var children = fieldset.children;

    // // loop through children and reorder based on relevant fields
    // for (var i = 0; i < children.length; i++) {
    //     var child = children[i];
    //     var name = child.querySelector("input").name;

    //     if (relevantFields.includes(name)) {
    //         // display relevant field elements
    //         fieldset.appendChild(child);
    //     }
    // }






}


// wait for the page to load
document.addEventListener("DOMContentLoaded", function(event) {
    var element = document.querySelector('select[name="type"]');

    // trigger onchange event for element on page load
    var event = new Event('change');

    // trigger event
    element.dispatchEvent(event);
});
